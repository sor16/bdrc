<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tournament - Model comparison • bdrc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tournament - Model comparison">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bdrc</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/background.html">Background</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to bdrc</a></li>
    <li><a class="dropdown-item" href="../articles/tournament.html">Tournament - Model Comparison</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sor16/bdrc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tournament - Model comparison</h1>
                        <h4 data-toc-skip class="author">Solvi
Rognvaldsson, Rafael Daniel Vias, Birgir Hrafnkelsson and Axel Orn
Jansson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sor16/bdrc/blob/HEAD/vignettes/tournament.Rmd" class="external-link"><code>vignettes/tournament.Rmd</code></a></small>
      <div class="d-none name"><code>tournament.Rmd</code></div>
    </div>

    
    
<p>This vignette explores the ways you can compare the fit of the
different discharge rating curve models provided in the
<code>bdrc</code> package. The package includes four different models to
fit a discharge rating curve of different complexities. These are:</p>
<p><code><a href="../reference/plm0.html">plm0()</a></code> - Power-law model with a constant error variance
(hence the 0). This is a Bayesian hierarchical implementation of the
most commonly used discharge rating curve model in hydrological
practice.</p>
<p><code><a href="../reference/plm.html">plm()</a></code> - Power-law model with error variance that varies
with water elevation.</p>
<p><code><a href="../reference/gplm0.html">gplm0()</a></code> - Generalized power-law model with a constant
error variance (hence the 0). The generalized power law is introduced in
Hrafnkelsson et al. (2022).</p>
<p><code><a href="../reference/gplm.html">gplm()</a></code> - Generalized power-law model with error variance
that varies with water elevation. The generalized power law is
introduced in Hrafnkelsson et al. (2022).</p>
<p>To learn more about the models, see Hrafnkelsson et al. (2022). To
learn about how to run the models on your data, see the <a href="introduction.html">introduction vignette</a>. The tournament is a
model comparison method that uses the Widely Applicable Information
Criterion (WAIC) (see Watanabe (2010)) to select the most appropriate of
the four models given the data. The WAIC consists of two terms, a
measure of the goodness-of-fit, and a penalizing term to account for
model complexity (effective number of parameters). The first round of
model comparisons sets up two games between model types, <em>gplm</em>
vs <em>gplm0</em>, and <em>plm</em> vs. <em>plm0</em>. The two
comparisons are conducted such that if the WAIC of the more complex
model ( <em>gplm</em> and <em>plm</em>, respectively ) is smaller than
the WAIC of the simpler models ( <em>gplm0</em> and <em>plm0</em>,
respectively ) by a pre-specified value called the winning criteria
(default value = 2), then it wins the game and is chosen as the more
appropriate model. If not, the simpler model is chosen. The more
appropriate models move on to the second round and are compared in the
same way. The winner of the second round is chosen as the overall
tournament winner and deemed the most appropriate model given the data.
In each match, the difference in WAIC is defined as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>WAIC<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>=</mo><annotation encoding="application/x-tex">=</annotation></semantics></math>WAIC<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi></mi><mtext mathvariant="normal">simple</mtext></msub><mo>−</mo></mrow><annotation encoding="application/x-tex">_{\text{simple}}-</annotation></semantics></math>WAIC<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mtext mathvariant="normal">complex</mtext></msub><annotation encoding="application/x-tex">_{\text{complex}}</annotation></semantics></math>.
A positive value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>WAIC
indicates that the more complex model is a more appropriate model, but
the more complex model only goes through to the final round if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>WAIC
is greater than the winning criteria.</p>
<p>To introduce the tournament function, we will use a dataset from the
stream gauging station Krokfors in Sweden that comes with the
package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(bdrc)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(krokfors)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="sc">&gt;</span> krokfors</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt;           W          Q</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; 1  9.478000 10.8211700</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#&gt; 2  8.698000  1.5010000</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt; 3  9.009000  3.3190000</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; 4  8.097000  0.1595700</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; 5  9.104000  4.5462500</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt; 6  8.133774  0.2121178</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt; 7  8.569583  1.1580000</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; 8  9.139151  4.8110000</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt; 9  9.464250 10.9960000</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; 10 8.009214  0.0984130</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; 11 8.961843  2.7847910</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co">#&gt; 12 8.316000  0.6631890</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co">#&gt; 13 8.828716  1.8911800</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co">#&gt; 14 9.897000 20.2600000</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#&gt; 15 7.896000  0.0190000</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#&gt; 16 9.534000 12.1000000</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">#&gt; 17 9.114000  4.3560000</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#&gt; 18 8.389000  0.6200000</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co">#&gt; 19 8.999000  2.6800000</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co">#&gt; 20 9.099000  3.7310000</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co">#&gt; 21 8.502000  0.8930000</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co">#&gt; 22 8.873000  1.9000000</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="co">#&gt; 23 8.240000  0.3200000</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co">#&gt; 24 9.219000  5.9000000</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">#&gt; 25 9.271000  6.9000000</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="co">#&gt; 26 8.370000  0.4420000</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="co">#&gt; 27 9.431000  9.0000000</span></span></code></pre></div>
<div class="section level2">
<h2 id="running-a-tournament">Running a tournament<a class="anchor" aria-label="anchor" href="#running-a-tournament"></a>
</h2>
<p>The tournament function is easy to use. All you need are two
mandatory input arguments: <code>formula</code> and <code>data</code>.
The <code>formula</code> is of the form <code>y ~ x</code>, where
<code>y</code> is the discharge in
m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mn>3</mn></msup><mi>/</mi></mrow><annotation encoding="application/x-tex">^3/</annotation></semantics></math>s,
and <code>x</code> is the water elevation in m (it is very important
that the data is in the correct units). The <code>data</code> argument
must be a <code>data.frame</code> including <code>x</code> and
<code>y</code> as column names. In our case, the dataset from Krokfors
has a column named <code>Q</code> which includes the discharge
measurements, and a column <code>W</code> which includes the water
elevation measurements. We are ready to run our first tournament:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># set seed for reproducibility</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="sc">&gt;</span> t_obj <span class="ot">&lt;-</span> <span class="fu">tournament</span>(Q <span class="sc">~</span> W, krokfors, <span class="at">parallel =</span> <span class="cn">TRUE</span>, <span class="at">num_cores =</span> <span class="dv">2</span>) <span class="co"># by default parallel=TRUE and the number of cores is detected on the machine</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; Running tournament [                                                ] 0%</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; Progress:</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; Initializing Metropolis MCMC algorithm...</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; Multiprocess sampling (4 chains in 2 jobs) ...</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; MCMC sampling completed!</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; Diagnostics:</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; Acceptance rate: 25.33%.</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; ✔ All chains have mixed well (Rhat &lt; 1.1).</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; ✔ Effective sample sizes sufficient (eff_n_samples &gt; 400).</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; - gplm finished  [============                                    ] 25%</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; Progress:</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; Initializing Metropolis MCMC algorithm...</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt; Multiprocess sampling (4 chains in 2 jobs) ...</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt; MCMC sampling completed!</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt; Diagnostics:</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt; Acceptance rate: 31.14%.</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt; ✔ All chains have mixed well (Rhat &lt; 1.1).</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt; ✔ Effective sample sizes sufficient (eff_n_samples &gt; 400).</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt; - gplm0 finished [========================                        ] 50%</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt; Progress:</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt; Initializing Metropolis MCMC algorithm...</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt; Multiprocess sampling (4 chains in 2 jobs) ...</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt; MCMC sampling completed!</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt; Diagnostics:</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt; Acceptance rate: 25.66%.</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt; ✔ All chains have mixed well (Rhat &lt; 1.1).</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt; ✔ Effective sample sizes sufficient (eff_n_samples &gt; 400).</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt; - plm finished   [====================================            ] 75%</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt; Progress:</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt; Initializing Metropolis MCMC algorithm...</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt; Multiprocess sampling (4 chains in 2 jobs) ...</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt; MCMC sampling completed!</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="co">#&gt; Diagnostics:</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a><span class="co">#&gt; Acceptance rate: 36.04%.</span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="co">#&gt; ✔ All chains have mixed well (Rhat &lt; 1.1).</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a><span class="co">#&gt; ✔ Effective sample sizes sufficient (eff_n_samples &gt; 400).</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="co">#&gt; - plm0 finished  [================================================] 100%</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="co">#&gt; Tournament winner: gplm0</span></span></code></pre></div>
<p>The function runs the four models and then the tournament. If you
have already run the four different kinds of models, <code>plm0</code>,
<code>plm</code>, <code>gplm0</code> and <code>gplm</code>, and they are
stored in objects, say <code>plm0.fit</code>, <code>plm.fit</code>,
<code>gplm0.fit</code> and <code>gplm.fit</code>, then you can
alternatively run the tournament very efficiently in the following
way:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">&gt;</span> t_obj <span class="ot">&lt;-</span> <span class="fu">tournament</span>(<span class="fu">list</span>(plm0.fit, plm.fit, gplm0.fit, gplm.fit))</span></code></pre></div>
<p>Evaluating the tournament object gives you the name of the winner</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="sc">&gt;</span> t_obj <span class="co"># or alternatively print(t_obj)</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; Tournament winner: gplm0</span></span></code></pre></div>
<p>For a more detailed summary of the results of the tournament,
write</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(t_obj)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt;   round game model      lppd eff_num_param       WAIC Delta_WAIC winner</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; 1     1    1  gplm 20.779382      6.870566 -27.817631  0.5570133  FALSE</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; 2     1    1 gplm0 20.370954      6.740645 -27.260617         NA   TRUE</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; 3     1    2   plm  5.584163      4.257375  -2.653577 -0.4065514  FALSE</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; 4     1    2  plm0  5.628423      4.098359  -3.060129         NA   TRUE</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; 5     2    3 gplm0 20.370954      6.740645 -27.260617 24.2004887   TRUE</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; 6     2    3  plm0  5.628423      4.098359  -3.060129         NA  FALSE</span></span></code></pre></div>
<p>Notice here that in round 1, <code>gplm0</code> is favored over
<code>gplm</code> in the first game, and <code>plm0</code> over
<code>plm</code> in the second. In the second round, <code>gplm0</code>
is deemed the tournament winner, i.e., the model that provides the best
simplicity and goodness-of-fit trade-off with the data at hand.</p>
</div>
<div class="section level2">
<h2 id="comparing-different-components-of-the-models">Comparing different components of the models<a class="anchor" aria-label="anchor" href="#comparing-different-components-of-the-models"></a>
</h2>
<p>There are several tools to visualize the different aspects of the
model comparison. To get a visual summary of the results of the
different games in the tournament, write</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(t_obj) <span class="co">#default plot type is type='tournament_results'</span></span></code></pre></div>
<p><img src="tournament_files/figure-html/unnamed-chunk-7-1.png" alt="&lt;em&gt;A diagram showing the results of the power-law tournament. The diagram progresses from bottom (four initial models) to top (single winner). Each model's residual plot is shown at the bottom, with corresponding WAIC values above. Green WAIC values indicate the more parsimonious models in each comparison for these data. The first round selects gplm0 and plm0, which advance to the final comparison. gplm0 emerges as the tournament winner, indicated by its green WAIC value and the name at the top of the diagram.&lt;/em&gt;" width="768" style="display: block; margin: auto;"></p>
<p>An informative way of comparing the goodness-of-fit of the models is
to compare the posteriors of the log-likelihood values. The values are
often shown on the deviance scale, i.e., minus 2 times the
log-likelihood. A lower value on the deviance scale implies a better fit
to the data. To plot a boxplot of the posterior log-likelihood values
for each model, we write</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(t_obj, <span class="at">type =</span> <span class="st">'boxplot'</span>)</span></code></pre></div>
<p><img src="tournament_files/figure-html/unnamed-chunk-8-1.png" alt="A comparative boxplot displaying posterior log-likelihood values for the models, with corresponding WAIC values shown as red diamonds. The log-likelihood values are presented on the deviance scale for direct comparison with WAIC. Each boxplot represents the distribution of log-likelihood values computed with the samples from the posterior distribution of the corresponding model. This visualization allows for easy comparison of model performance and fit across the four models." width="768" style="display: block; margin: auto;"></p>
<p>The red diamonds on the plot denote the WAIC values for the
respective models. Next, to plot the four rating curves that were
estimated by the different models, write</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(t_obj, <span class="at">type =</span> <span class="st">'rating_curve'</span>)</span></code></pre></div>
<p><img src="tournament_files/figure-html/unnamed-chunk-9-1.png" alt="A plot comparing the rating curves estimated by four models. The graph shows water level (stage) on the y-axis and discharge on the x-axis. Each model's estimated rating curve is represented by a solid line, with dotted lines showing the 95% prediction interval. This visualization enables assessment of model fit across the range of water levels, highlighting differences in predictive capabilities. Optimal performance is indicated by the solid line following the mean of observations and 95% of observations falling within the prediction interval." width="768" style="display: block; margin: auto;"></p>
<p>Another useful plot is the residual plot</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(t_obj, <span class="at">type =</span> <span class="st">'residuals'</span>)</span></code></pre></div>
<p><img src="tournament_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The differences between the four models lie in the modeling of the
power-law exponent,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(h)</annotation></semantics></math>,
and the error variance at the response level,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>ε</mi><mn>2</mn></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sigma^2_{\varepsilon}(h)</annotation></semantics></math>.
Thus, it is insightful to look at the posterior of the power-law
exponent for the different models</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(t_obj, <span class="at">type =</span> <span class="st">'f'</span>)</span></code></pre></div>
<p><img src="tournament_files/figure-html/unnamed-chunk-11-1.png" width="768" style="display: block; margin: auto;"></p>
<p>and the standard deviation of the error terms at the response
level</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(t_obj, <span class="at">type =</span> <span class="st">'sigma_eps'</span>)</span></code></pre></div>
<p><img src="tournament_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Finally, the panel option is useful to gain insight into all
different model components of the winning model, which in this case is
<code>gplm0</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(t_obj, <span class="at">type =</span> <span class="st">'panel'</span>, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="tournament_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="customizing-tournaments">Customizing tournaments<a class="anchor" aria-label="anchor" href="#customizing-tournaments"></a>
</h2>
<p>There are a few ways to customize the tournament further. For
example, if the parameter of zero discharge
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
is known, you might want to fix that parameter to the known value in the
model. Assume
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>7.65</mn><annotation encoding="application/x-tex">7.65</annotation></semantics></math>
m is the known value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>.
Then you can directly run a tournament with the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
parameter fixed in all the models</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="sc">&gt;</span> t_obj_known_c <span class="ot">&lt;-</span> <span class="fu">tournament</span>(<span class="at">formula =</span> Q <span class="sc">~</span> W , <span class="at">data =</span> krokfors, <span class="at">c_param =</span> <span class="fl">7.65</span>)</span></code></pre></div>
<p>One can also change the winning criteria (default value = 2) which
sets the threshold that the more complex model in each model comparison
must exceed, in terms of the model comparison criteria (default method
is <code>"WAIC"</code>). For example, increasing the value to
<code>winning_criteria = 5</code> raises the threshold that the more
complex model must exceed to win a game, thus favoring model simplicity
more than if the default value of 2 were used. To re-evaluate a
previously run tournament using a different winning criteria, the most
efficient way is to input the list of stored model objects in the
existing tournament object. In our case we have the tournament stored in
<code>t_obj</code>, so we can write</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="sc">&gt;</span> t_obj_conservative <span class="ot">&lt;-</span> <span class="fu">tournament</span>(t_obj<span class="sc">$</span>contestants, <span class="at">winning_criteria =</span> <span class="dv">5</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; Tournament winner: gplm0</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(t_obj_conservative)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt;   round game model      lppd eff_num_param       WAIC Delta_WAIC winner</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; 1     1    1  gplm 20.779382      6.870566 -27.817631  0.5570133  FALSE</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; 2     1    1 gplm0 20.370954      6.740645 -27.260617         NA   TRUE</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; 3     1    2   plm  5.584163      4.257375  -2.653577 -0.4065514  FALSE</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; 4     1    2  plm0  5.628423      4.098359  -3.060129         NA   TRUE</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; 5     2    3 gplm0 20.370954      6.740645 -27.260617 24.2004887   TRUE</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; 6     2    3  plm0  5.628423      4.098359  -3.060129         NA  FALSE</span></span></code></pre></div>
<p>There is also an option to change the method used to estimate the
predictive performance of the models. The default method is
<code>"WAIC"</code> (see Watanabe (2010)) which is a fully Bayesian
method that uses the full set of posterior draws to calculate the best
possible estimate of the expected log pointwise predictive density.
Other allowed methods are <code>"DIC"</code> and <code>"PMP"</code>. The
DIC (see Spiegelhalter (2002)) is similar to WAIC but instead of using
the full set of posterior draws to compute the estimate of the expected
log pointwise predictive density, it uses a point estimate of the
posterior distribution. Both methods <code>"WAIC"</code> and
<code>"DIC"</code> have a default value of 2 for the winning criteria.
We again run the efficient re-evaluation of the tournament</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="sc">&gt;</span> t_obj_DIC <span class="ot">&lt;-</span> <span class="fu">tournament</span>(t_obj<span class="sc">$</span>contestants, <span class="at">method =</span> <span class="st">"DIC"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; Tournament winner: gplm0</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(t_obj_DIC)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt;   round game model     D_hat eff_num_param        DIC  Delta_DIC winner</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; 1     1    1  gplm -42.77317      6.063058 -30.647051  0.8498163  FALSE</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; 2     1    1 gplm0 -42.48795      6.345358 -29.797235         NA   TRUE</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; 3     1    2   plm -11.34004      2.973852  -5.392337 -0.3058411  FALSE</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; 4     1    2  plm0 -11.47124      2.886532  -5.698178         NA   TRUE</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; 5     2    3 gplm0 -42.48795      6.345358 -29.797235 24.0990569   TRUE</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; 6     2    3  plm0 -11.47124      2.886532  -5.698178         NA  FALSE</span></span></code></pre></div>
<p>The third and final method that can be chosen is <code>"PMP"</code>,
which uses the posterior model probabilities, calculated with Bayes
factor (see Jeffreys (1961) and Kass and Raftery (1995)), to compare the
models, where all the models are assumed a priori to be equally likely.
When using the method <code>"PMP"</code>, the value of the winning
criteria should be a real number between 0 and 1, since this represents
the threshold value that the posterior probability of the more complex
model has to surpass to be selected as the appropriate model. The
default value in this case for the winning criteria is 0.75, which again
slightly favors model simplicity. The value 0.75 should give similar
results to the other two methods with their respective default values of
2. The method <code>"PMP"</code> is not chosen as the default method
because the Bayes factor calculations can be quite unstable. Let’s now
use this method, but raise the winning criteria from 0.75 to 0.9</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="sc">&gt;</span> t_obj_prob <span class="ot">&lt;-</span> <span class="fu">tournament</span>(t_obj<span class="sc">$</span>contestants, <span class="at">method =</span> <span class="st">"PMP"</span>, <span class="at">winning_criteria =</span> <span class="fl">0.9</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; ⚠ Warning: The Harmonic Mean Estimator (HME) is used to estimate the Bayes Factor for the posterior model probability (PMP), which is known to be unstable and potentially unreliable. We recommend using method "WAIC" (Widely Applicable Information Criterion) for model comparison instead.</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; Tournament winner: gplm0</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(t_obj_prob) </span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt;   round game model     marg_lik    Post_prob winner</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; 1     1    1  gplm 2.560009e+04 4.537982e-01  FALSE</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; 2     1    1 gplm0 3.081285e+04 5.462018e-01   TRUE</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; 3     1    2   plm 2.659317e+00 9.259920e-01   TRUE</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; 4     1    2  plm0 2.125404e-01 7.400798e-02  FALSE</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; 5     2    3 gplm0 3.081285e+04 9.999137e-01   TRUE</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; 6     2    3   plm 2.659317e+00 8.629801e-05  FALSE</span></span></code></pre></div>
<p>We see that the results of the tournament do not change in this
example, and the winner of the third and final game is still
<code>gplm0</code>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Hrafnkelsson, B., Sigurdarson, H., Rögnvaldsson, S., Jansson, A. Ö.,
Vias, R. D., and Gardarsson, S. M. (2022). <em>Generalization of the
power-law rating curve using hydrodynamic theory and Bayesian
hierarchical modeling</em>, Environmetrics, 33(2):e2711. doi: <a href="https://doi.org/10.1002/env.2711" class="external-link uri">https://doi.org/10.1002/env.2711</a></p>
<p>Jeffreys, H. (1961). <em>Theory of Probability</em>, Third Edition.
Oxford University Press.</p>
<p>Kass, R., and A. Raftery, A. (1995). <em>Bayes Factors</em>. Journal
of the American Statistical Association, 90, 773-795. doi: <a href="https://doi.org/10.1080/01621459.1995.10476572" class="external-link uri">https://doi.org/10.1080/01621459.1995.10476572</a></p>
<p>Spiegelhalter, D., Best, N., Carlin, B., Van Der Linde, A. (2002).
<em>Bayesian measures of model complexity and fit</em>. Journal of the
Royal Statistical Society: Series B (Statistical Methodology) 64(4),
583–639. doi: <a href="https://doi.org/10.1111/1467-9868.00353" class="external-link uri">https://doi.org/10.1111/1467-9868.00353</a></p>
<p>Watanabe, S. (2010). <em>Asymptotic equivalence of Bayes cross
validation and widely applicable information criterion in singular
learning theory</em>. Journal of Machine Learning Research, 11,
3571–3594.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://english.hi.is/staff/birgirhr" class="external-link">Birgir Hrafnkelsson</a>, <a href="https://github.com/sor16" class="external-link">Solvi Rognvaldsson</a>, <a href="https://github.com/axelornj" class="external-link">Axel Orn Jansson</a>, Rafael Daníel Vias.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
