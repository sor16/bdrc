<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • bdrc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="bdrc">
<meta property="og:image" content="/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bdrc</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/background.html">Background</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to bdrc</a>
    </li>
    <li>
      <a href="../articles/tournament.html">Tournament - Model Comparison</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sor16/bdrc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
                        <h4 data-toc-skip class="author">Solvi Rognvaldsson, Rafael Vias, Birgir Hrafnkelsson and Axel Orn Jansson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sor16/bdrc/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>A discharge rating curve is a model that describes the relationship between water elevation and discharge in a river. The rating curve is estimated from paired observations of water elevation and discharge and it is used to predict discharge for a given water elevation. This is the main practical usage of rating curves, as water elevation is substantially easier to directly observe than discharge. Four different discharge rating curve models are implemented in this R package using a Bayesian hierarchical model:</p>
<p><code><a href="../reference/plm0.html">plm0()</a></code> - Power-law model with a constant error variance (hence the 0). This is a Bayesian hierarchical implementation of the most commonly used discharge rating curve model in hydrological practice.</p>
<p><code><a href="../reference/plm.html">plm()</a></code> - Power-law model with error variance that varies with water elevation.</p>
<p><code><a href="../reference/gplm0.html">gplm0()</a></code> - Generalized power-law model with a constant error variance (hence the 0). The generalized power law is introduced in Hrafnkelsson et al. (2022).</p>
<p><code><a href="../reference/gplm.html">gplm()</a></code> - Generalized power-law model with error variance that varies with water elevation. The generalized power law is introduced in Hrafnkelsson et al. (2022).</p>
<p>For further details about the different models, see Hrafnkelsson et al. (2022). The models differ in their complexity, <tt>gplm</tt> being the most flexible and complex model. We will focus on the use of <tt>gplm</tt> throughout this introduction vignette and explore the different ways to fit the <tt>gplm</tt> and visualize its output. However, the API of the functions for the other three models are completely identical so this vignette also helps users to run those models.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(bdrc)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">set.seed</span>(<span class="dv">1</span>) <span class="co">#set seed for reproducibility</span></span></code></pre></div>
<p>We will use a dataset from a stream gauging station in Sweden, called Krokfors, that comes with the package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(krokfors)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="op">&gt;</span><span class="st"> </span>krokfors</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt;           W          Q</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt; 1  9.478000 10.8211700</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; 2  8.698000  1.5010000</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; 3  9.009000  3.3190000</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; 4  8.097000  0.1595700</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; 5  9.104000  4.5462500</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; 6  8.133774  0.2121178</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; 7  8.569583  1.1580000</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; 8  9.139151  4.8110000</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; 9  9.464250 10.9960000</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; 10 8.009214  0.0984130</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt; 11 8.961843  2.7847910</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; 12 8.316000  0.6631890</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt; 13 8.828716  1.8911800</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; 14 9.897000 20.2600000</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; 15 7.896000  0.0190000</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt; 16 9.534000 12.1000000</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt; 17 9.114000  4.3560000</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt; 18 8.389000  0.6200000</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt; 19 8.999000  2.6800000</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">#&gt; 20 9.099000  3.7310000</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">#&gt; 21 8.502000  0.8930000</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt; 22 8.873000  1.9000000</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt; 23 8.240000  0.3200000</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt; 24 9.219000  5.9000000</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">#&gt; 25 9.271000  6.9000000</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co">#&gt; 26 8.370000  0.4420000</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">#&gt; 27 9.431000  9.0000000</span></span></code></pre></div>
<div class="section level2">
<h2 id="fitting-a-discharge-rating-curve">Fitting a discharge rating curve<a class="anchor" aria-label="anchor" href="#fitting-a-discharge-rating-curve"></a>
</h2>
<p>It is very simple to fit a discharge rating curve with the <em>bdrc</em> package. All you need are two mandatory input arguments, <tt>formula</tt> and <tt>data</tt>. The <tt>formula</tt> is of the form <tt>y</tt>~<tt>x</tt>, where <tt>y</tt> is the discharge in square meters per second (m<span class="math inline">\(^3/\)</span>s), and <tt>x</tt> is the water elevation in meters (m). It is very important that the data is in the correct units! The <tt>data</tt> argument must be a data.frame including <tt>x</tt> and <tt>y</tt> as column names. In our case, the Krokfors data has the discharge and water elevation measurements stored in columns named <tt>Q</tt> and <tt>W</tt>, respectively. We are ready to fit a discharge rating curve using the <tt>gplm</tt> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">&gt;</span><span class="st"> </span>gplm.fit &lt;-<span class="st"> </span><span class="kw">gplm</span>(Q<span class="op">~</span>W,<span class="dt">data=</span>krokfors,<span class="dt">parallel=</span><span class="ot">TRUE</span>,<span class="dt">num_cores=</span><span class="dv">2</span>) <span class="co"># parallel=TRUE by default and by default, the number of cores is detected on the machine</span></span></code></pre></div>
<p>The <tt>gplm</tt> function returns an object of class “gplm” which we can summarize and visualize using familiar functions such as</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(gplm.fit)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#&gt; </span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; Formula: </span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt;  Q ~ W</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; Latent parameters:</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt;   lower-2.5% median-50% upper-97.5%</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; a 1.50       1.94       2.23       </span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; b 1.83       1.84       1.84       </span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; </span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; Hyperparameters:</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt;            lower-2.5% median-50% upper-97.5%</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; c           7.71211    7.8102     7.856     </span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; sigma_beta  0.42368    0.7066     1.288     </span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; phi_beta    0.57452    1.1910     2.874     </span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; sigma_eta   0.00329    0.0912     0.534     </span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; eta_1      -4.93445   -4.2566    -3.557     </span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; eta_2      -5.94891   -4.0659    -2.280     </span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; eta_3      -6.87756   -4.2049    -1.611     </span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; eta_4      -7.71587   -4.4949    -1.223     </span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; eta_5      -8.24321   -4.6293    -0.680     </span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; eta_6      -8.78471   -4.6121    -0.250     </span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; </span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt; WAIC: 1.112881</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;"></p>
<p>In the next section, we will dive deeper into visualizing the “gplm” object.</p>
</div>
<div class="section level2">
<h2 id="visualizing-posterior-distributions-of-different-parameters">Visualizing posterior distributions of different parameters<a class="anchor" aria-label="anchor" href="#visualizing-posterior-distributions-of-different-parameters"></a>
</h2>
<p>The <em>bdrc</em> package provides several tools to visualize the results from model objects which can give insight into the physical properties of the river at hand. For instance, the hyperparameter <span class="math inline">\(c\)</span> corresponds to the water elevation of zero discharge. To visualize the posterior of <span class="math inline">\(c\)</span>, we can write</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="st">'c'</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Technically, instead of inferring <span class="math inline">\(c\)</span> directly, <span class="math inline">\(h_{min}-c\)</span> is inferred, where <span class="math inline">\(h_{min}\)</span> is the lowest water elevation value in the data. Since the parameter <span class="math inline">\(h_{min}-c\)</span> is strictly positive, a transformation <span class="math inline">\(\zeta=log(h_{min}-c)\)</span> is used for the Bayesian inference so that it has support on the real line. To plot the transformed posterior we write</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="st">'c'</span>,<span class="dt">transformed=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The <tt>param</tt> argument can also be a vector containing multiple parameter names. For example, to visualize the posterior distributions of the parameters <span class="math inline">\(a\)</span> and <span class="math inline">\(c\)</span>, we can write</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="kw">c</span>(<span class="st">'a'</span>,<span class="st">'c'</span>))</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;"></p>
<p>There is a shorthand to visualize the hyperparameters all at once</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="st">'hyperparameters'</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="960" style="display: block; margin: auto;"></p>
<p>Similarly, writing ‘latent_parameters’ plots the latent parameters in one plot. To plot the hyperparameters transformed on the same scale as in the Bayesian inference, we write</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'histogram'</span>,<span class="dt">param=</span><span class="st">'hyperparameters'</span>,<span class="dt">transformed=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-10-1.png" width="960" style="display: block; margin: auto;"></p>
<p>Finally, we can visualize the components of the model that are allowed (depending on the model) to vary with water elevation, that is, the power-law exponent, <span class="math inline">\(f(h)\)</span>, and the standard deviation of the error terms at the response level, <span class="math inline">\(\sigma_{\varepsilon}(h)\)</span>. Both <tt>gplm0</tt> and <tt>gplm</tt> generalize the power-law exponent by modeling it as a sum of a constant term, <span class="math inline">\(b\)</span>, and Gaussian process, <span class="math inline">\(\beta(h)\)</span>, namely <span class="math inline">\(f(h)=b+\beta(h)\)</span>, where <span class="math inline">\(\beta(h)\)</span> is assumed to be twice differentiable with mean zero. On the other hand, <tt>plm</tt> and <tt>plm0</tt> both model the power-law exponent as a constant by setting <span class="math inline">\(\beta(h)=0\)</span>, which gives <span class="math inline">\(f(h)=b\)</span>. We can plot the inferred power-law exponent with</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'f'</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Both <tt>plm</tt> and <tt>gplm</tt> model the standard deviation of the error terms at the response level, <span class="math inline">\(\sigma_{\varepsilon}(h)\)</span>, as a function of water elevation, using B-splines basis functions, while <tt>plm0</tt> and <tt>gplm0</tt> model the standard deviation as a constant. We can plot the inferred standard deviation by writing</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'sigma_eps'</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></p>
<p>To get a visual summary of your model, the ‘panel’ option in the plot type is useful:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'panel'</span>,<span class="dt">transformed=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="assessing-model-fitness-and-convergence">Assessing model fitness and convergence<a class="anchor" aria-label="anchor" href="#assessing-model-fitness-and-convergence"></a>
</h2>
<p>The package has several functions for convergence diagnostics of a bdrc model, most notably the residual plot, trace plots, autocorrelation plots, and Gelman-Rubin diagnostic plots. The log-residuals can be plotted with</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'residuals'</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The log-residuals are calculated by subtracting the posterior estimate (median) of the log-discharge, <span class="math inline">\(log(\hat{Q})\)</span>, from the observed log-discharge, <span class="math inline">\(log(Q)\)</span>. Additionally, the plot includes the 95% predictive intervals of log(Q) (- -) and 95% credible intervals for the expected value of log(Q) (—), the latter reflecting the rating curve uncertainty.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'trace'</span>,<span class="dt">param=</span><span class="st">'c'</span>,<span class="dt">transformed=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-15-1.png" width="960" style="display: block; margin: auto;"></p>
<p>To plot a trace plot for all the transformed hyperparameters, we write</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'trace'</span>,<span class="dt">param=</span><span class="st">'hyperparameters'</span>,<span class="dt">transformed=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-16-1.png" width="960" style="display: block; margin: auto;"></p>
<p>To assess the mixing and convergence of the MCMC chains for each parameter, you can visualize the Gelman-Rubin statistic, <span class="math inline">\(\hat{R}\)</span>, as presented by Gelman and Rubin (1992) with:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'r_hat'</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-17-1.png" width="768" style="display: block; margin: auto;"></p>
<p>And finally, autocorrelation of parameters can be assessed with</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(gplm.fit,<span class="dt">type=</span><span class="st">'autocorrelation'</span>)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-18-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="customization-of-models">Customization of models<a class="anchor" aria-label="anchor" href="#customization-of-models"></a>
</h2>
<p>There are ways to further customize the <tt>gplm</tt> function. In some instances, the parameter of zero discharge, <span class="math inline">\(c\)</span>, is known, and you might want to fix the model parameter to the known value. In addition, you might want to extrapolate the rating curve to higher water elevation values by adjusting the maximum water elevation. Assume 7.65 m is the known value of <span class="math inline">\(c\)</span> and you want to calculate the rating curve for water elevation values up to 10 m, then your function call would look like this</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="op">&gt;</span><span class="st"> </span>gplm.fit.known_c &lt;-<span class="st"> </span><span class="kw">gplm</span>(Q<span class="op">~</span>W,krokfors,<span class="dt">c_param=</span><span class="fl">7.65</span>,<span class="dt">h_max=</span><span class="dv">10</span>,<span class="dt">parallel=</span><span class="ot">FALSE</span>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prediction-for-an-equally-spaced-grid-of-water-elevations">Prediction for an equally spaced grid of water elevations<a class="anchor" aria-label="anchor" href="#prediction-for-an-equally-spaced-grid-of-water-elevations"></a>
</h2>
<p>To get rating curve predictions for an equally spaced grid of water elevation values, you can use the predict function. Note that only values in the range from <span class="math inline">\(c\)</span> and h_max are accepted, as that is the range in which the Bayesian inference was performed</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="op">&gt;</span><span class="st"> </span>h_grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">8</span>,<span class="dv">9</span>,<span class="dt">by=</span><span class="fl">0.01</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="op">&gt;</span><span class="st"> </span>rating_curve_h_grid &lt;-<span class="st"> </span><span class="kw">predict</span>(gplm.fit,<span class="dt">newdata=</span>h_grid)</span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(rating_curve_h_grid)</span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">#&gt;        h      lower     median     upper</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co">#&gt; 1   8.00 0.06163328 0.08270752 0.1111879</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co">#&gt; 2   8.01 0.06739421 0.09041000 0.1208589</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co">#&gt; 3   8.02 0.07364158 0.09877837 0.1318364</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co">#&gt; 4   8.03 0.07988896 0.10714673 0.1428140</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="co">#&gt; 5   8.04 0.08629765 0.11567736 0.1540129</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="co">#&gt; 6   8.05 0.09360354 0.12511039 0.1664427</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="co">#&gt; 7   8.06 0.10090942 0.13454342 0.1788724</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="co">#&gt; 8   8.07 0.10839807 0.14413626 0.1913006</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co">#&gt; 9   8.08 0.11651192 0.15427579 0.2037235</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="co">#&gt; 10  8.09 0.12462576 0.16441532 0.2161463</span></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="co">#&gt; 11  8.10 0.13278452 0.17485156 0.2291399</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="co">#&gt; 12  8.11 0.14104807 0.18598012 0.2434656</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="co">#&gt; 13  8.12 0.14931161 0.19710867 0.2577913</span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="co">#&gt; 14  8.13 0.15757516 0.20823723 0.2721170</span></span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="co">#&gt; 15  8.14 0.16685505 0.21993478 0.2872112</span></span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="co">#&gt; 16  8.15 0.17675100 0.23197725 0.3027713</span></span>
<span id="cb20-21"><a href="#cb20-21"></a><span class="co">#&gt; 17  8.16 0.18664696 0.24401971 0.3183314</span></span>
<span id="cb20-22"><a href="#cb20-22"></a><span class="co">#&gt; 18  8.17 0.19637028 0.25680451 0.3356573</span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="co">#&gt; 19  8.18 0.20608769 0.26961468 0.3530435</span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="co">#&gt; 20  8.19 0.21611184 0.28271149 0.3706802</span></span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="co">#&gt; 21  8.20 0.22681457 0.29644247 0.3888710</span></span>
<span id="cb20-26"><a href="#cb20-26"></a><span class="co">#&gt; 22  8.21 0.23751730 0.31017345 0.4070618</span></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="co">#&gt; 23  8.22 0.24860815 0.32450089 0.4254459</span></span>
<span id="cb20-28"><a href="#cb20-28"></a><span class="co">#&gt; 24  8.23 0.25990283 0.33914160 0.4439315</span></span>
<span id="cb20-29"><a href="#cb20-29"></a><span class="co">#&gt; 25  8.24 0.27119751 0.35378232 0.4624171</span></span>
<span id="cb20-30"><a href="#cb20-30"></a><span class="co">#&gt; 26  8.25 0.28204791 0.36935394 0.4811805</span></span>
<span id="cb20-31"><a href="#cb20-31"></a><span class="co">#&gt; 27  8.26 0.29289831 0.38492556 0.4999439</span></span>
<span id="cb20-32"><a href="#cb20-32"></a><span class="co">#&gt; 28  8.27 0.30486210 0.40061590 0.5198067</span></span>
<span id="cb20-33"><a href="#cb20-33"></a><span class="co">#&gt; 29  8.28 0.31809836 0.41644192 0.5409261</span></span>
<span id="cb20-34"><a href="#cb20-34"></a><span class="co">#&gt; 30  8.29 0.33133461 0.43226795 0.5620454</span></span>
<span id="cb20-35"><a href="#cb20-35"></a><span class="co">#&gt; 31  8.30 0.34452526 0.44936232 0.5827024</span></span>
<span id="cb20-36"><a href="#cb20-36"></a><span class="co">#&gt; 32  8.31 0.35771264 0.46654728 0.6033263</span></span>
<span id="cb20-37"><a href="#cb20-37"></a><span class="co">#&gt; 33  8.32 0.37116789 0.48374553 0.6256679</span></span>
<span id="cb20-38"><a href="#cb20-38"></a><span class="co">#&gt; 34  8.33 0.38502494 0.50096372 0.6505859</span></span>
<span id="cb20-39"><a href="#cb20-39"></a><span class="co">#&gt; 35  8.34 0.39922128 0.51928739 0.6736392</span></span>
<span id="cb20-40"><a href="#cb20-40"></a><span class="co">#&gt; 36  8.35 0.41364381 0.53834804 0.6954493</span></span>
<span id="cb20-41"><a href="#cb20-41"></a><span class="co">#&gt; 37  8.36 0.42890591 0.55728499 0.7204843</span></span>
<span id="cb20-42"><a href="#cb20-42"></a><span class="co">#&gt; 38  8.37 0.44437789 0.57619102 0.7463256</span></span>
<span id="cb20-43"><a href="#cb20-43"></a><span class="co">#&gt; 39  8.38 0.45642481 0.59522118 0.7760268</span></span>
<span id="cb20-44"><a href="#cb20-44"></a><span class="co">#&gt; 40  8.39 0.46890216 0.61437858 0.8051869</span></span>
<span id="cb20-45"><a href="#cb20-45"></a><span class="co">#&gt; 41  8.40 0.48525334 0.63468113 0.8294766</span></span>
<span id="cb20-46"><a href="#cb20-46"></a><span class="co">#&gt; 42  8.41 0.50160452 0.65498369 0.8537662</span></span>
<span id="cb20-47"><a href="#cb20-47"></a><span class="co">#&gt; 43  8.42 0.51808287 0.67564392 0.8790889</span></span>
<span id="cb20-48"><a href="#cb20-48"></a><span class="co">#&gt; 44  8.43 0.53489649 0.69724712 0.9071348</span></span>
<span id="cb20-49"><a href="#cb20-49"></a><span class="co">#&gt; 45  8.44 0.55171012 0.71885033 0.9351807</span></span>
<span id="cb20-50"><a href="#cb20-50"></a><span class="co">#&gt; 46  8.45 0.56895651 0.74084271 0.9640151</span></span>
<span id="cb20-51"><a href="#cb20-51"></a><span class="co">#&gt; 47  8.46 0.58673184 0.76331077 0.9938131</span></span>
<span id="cb20-52"><a href="#cb20-52"></a><span class="co">#&gt; 48  8.47 0.60450717 0.78577883 1.0236111</span></span>
<span id="cb20-53"><a href="#cb20-53"></a><span class="co">#&gt; 49  8.48 0.62369895 0.80992991 1.0547931</span></span>
<span id="cb20-54"><a href="#cb20-54"></a><span class="co">#&gt; 50  8.49 0.64374060 0.83509080 1.0868054</span></span>
<span id="cb20-55"><a href="#cb20-55"></a><span class="co">#&gt; 51  8.50 0.66378226 0.86025169 1.1188178</span></span>
<span id="cb20-56"><a href="#cb20-56"></a><span class="co">#&gt; 52  8.51 0.68209018 0.88510789 1.1515583</span></span>
<span id="cb20-57"><a href="#cb20-57"></a><span class="co">#&gt; 53  8.52 0.69996468 0.90988792 1.1844809</span></span>
<span id="cb20-58"><a href="#cb20-58"></a><span class="co">#&gt; 54  8.53 0.71968564 0.93542539 1.2188628</span></span>
<span id="cb20-59"><a href="#cb20-59"></a><span class="co">#&gt; 55  8.54 0.74093432 0.96158955 1.2544521</span></span>
<span id="cb20-60"><a href="#cb20-60"></a><span class="co">#&gt; 56  8.55 0.76228640 0.98806009 1.2896638</span></span>
<span id="cb20-61"><a href="#cb20-61"></a><span class="co">#&gt; 57  8.56 0.78388622 1.01526473 1.3239709</span></span>
<span id="cb20-62"><a href="#cb20-62"></a><span class="co">#&gt; 58  8.57 0.80551207 1.04251911 1.3584820</span></span>
<span id="cb20-63"><a href="#cb20-63"></a><span class="co">#&gt; 59  8.58 0.82773628 1.07091664 1.3976828</span></span>
<span id="cb20-64"><a href="#cb20-64"></a><span class="co">#&gt; 60  8.59 0.84996049 1.09931417 1.4368835</span></span>
<span id="cb20-65"><a href="#cb20-65"></a><span class="co">#&gt; 61  8.60 0.87218470 1.12771170 1.4760843</span></span>
<span id="cb20-66"><a href="#cb20-66"></a><span class="co">#&gt; 62  8.61 0.89516647 1.15877985 1.5165488</span></span>
<span id="cb20-67"><a href="#cb20-67"></a><span class="co">#&gt; 63  8.62 0.91830201 1.19039005 1.5572698</span></span>
<span id="cb20-68"><a href="#cb20-68"></a><span class="co">#&gt; 64  8.63 0.94143755 1.22200025 1.5979908</span></span>
<span id="cb20-69"><a href="#cb20-69"></a><span class="co">#&gt; 65  8.64 0.96706246 1.25492965 1.6386659</span></span>
<span id="cb20-70"><a href="#cb20-70"></a><span class="co">#&gt; 66  8.65 0.99420760 1.28866468 1.6793131</span></span>
<span id="cb20-71"><a href="#cb20-71"></a><span class="co">#&gt; 67  8.66 1.02135275 1.32239970 1.7199603</span></span>
<span id="cb20-72"><a href="#cb20-72"></a><span class="co">#&gt; 68  8.67 1.04911687 1.35645771 1.7664187</span></span>
<span id="cb20-73"><a href="#cb20-73"></a><span class="co">#&gt; 69  8.68 1.07777017 1.39097969 1.8212249</span></span>
<span id="cb20-74"><a href="#cb20-74"></a><span class="co">#&gt; 70  8.69 1.10642347 1.42550166 1.8760311</span></span>
<span id="cb20-75"><a href="#cb20-75"></a><span class="co">#&gt; 71  8.70 1.13526829 1.46117262 1.9285816</span></span>
<span id="cb20-76"><a href="#cb20-76"></a><span class="co">#&gt; 72  8.71 1.16487923 1.50143948 1.9721089</span></span>
<span id="cb20-77"><a href="#cb20-77"></a><span class="co">#&gt; 73  8.72 1.19449016 1.54170634 2.0156363</span></span>
<span id="cb20-78"><a href="#cb20-78"></a><span class="co">#&gt; 74  8.73 1.22410110 1.58197321 2.0591636</span></span>
<span id="cb20-79"><a href="#cb20-79"></a><span class="co">#&gt; 75  8.74 1.25664051 1.62383290 2.1128280</span></span>
<span id="cb20-80"><a href="#cb20-80"></a><span class="co">#&gt; 76  8.75 1.28939325 1.66580863 2.1672308</span></span>
<span id="cb20-81"><a href="#cb20-81"></a><span class="co">#&gt; 77  8.76 1.32214600 1.70778437 2.2216337</span></span>
<span id="cb20-82"><a href="#cb20-82"></a><span class="co">#&gt; 78  8.77 1.35675320 1.75209498 2.2803767</span></span>
<span id="cb20-83"><a href="#cb20-83"></a><span class="co">#&gt; 79  8.78 1.39229796 1.79758605 2.3413141</span></span>
<span id="cb20-84"><a href="#cb20-84"></a><span class="co">#&gt; 80  8.79 1.42784273 1.84307712 2.4022515</span></span>
<span id="cb20-85"><a href="#cb20-85"></a><span class="co">#&gt; 81  8.80 1.46451594 1.89029642 2.4647465</span></span>
<span id="cb20-86"><a href="#cb20-86"></a><span class="co">#&gt; 82  8.81 1.50290816 1.94014839 2.5296142</span></span>
<span id="cb20-87"><a href="#cb20-87"></a><span class="co">#&gt; 83  8.82 1.54130037 1.99000037 2.5944819</span></span>
<span id="cb20-88"><a href="#cb20-88"></a><span class="co">#&gt; 84  8.83 1.58065552 2.04043458 2.6603728</span></span>
<span id="cb20-89"><a href="#cb20-89"></a><span class="co">#&gt; 85  8.84 1.62654719 2.09482105 2.7332095</span></span>
<span id="cb20-90"><a href="#cb20-90"></a><span class="co">#&gt; 86  8.85 1.67243886 2.14920753 2.8060462</span></span>
<span id="cb20-91"><a href="#cb20-91"></a><span class="co">#&gt; 87  8.86 1.71833053 2.20359401 2.8788829</span></span>
<span id="cb20-92"><a href="#cb20-92"></a><span class="co">#&gt; 88  8.87 1.76422220 2.25798048 2.9517196</span></span>
<span id="cb20-93"><a href="#cb20-93"></a><span class="co">#&gt; 89  8.88 1.81075168 2.31809106 3.0243237</span></span>
<span id="cb20-94"><a href="#cb20-94"></a><span class="co">#&gt; 90  8.89 1.85755450 2.38065483 3.0968282</span></span>
<span id="cb20-95"><a href="#cb20-95"></a><span class="co">#&gt; 91  8.90 1.90435733 2.44321859 3.1693327</span></span>
<span id="cb20-96"><a href="#cb20-96"></a><span class="co">#&gt; 92  8.91 1.95566381 2.50867695 3.2568810</span></span>
<span id="cb20-97"><a href="#cb20-97"></a><span class="co">#&gt; 93  8.92 2.00856448 2.57515993 3.3497544</span></span>
<span id="cb20-98"><a href="#cb20-98"></a><span class="co">#&gt; 94  8.93 2.06146515 2.64164290 3.4426279</span></span>
<span id="cb20-99"><a href="#cb20-99"></a><span class="co">#&gt; 95  8.94 2.11425558 2.70934440 3.5282224</span></span>
<span id="cb20-100"><a href="#cb20-100"></a><span class="co">#&gt; 96  8.95 2.16701440 2.77739534 3.6117295</span></span>
<span id="cb20-101"><a href="#cb20-101"></a><span class="co">#&gt; 97  8.96 2.21977321 2.84544629 3.6952365</span></span>
<span id="cb20-102"><a href="#cb20-102"></a><span class="co">#&gt; 98  8.97 2.28284634 2.92415353 3.7931915</span></span>
<span id="cb20-103"><a href="#cb20-103"></a><span class="co">#&gt; 99  8.98 2.34824989 3.00526847 3.8944107</span></span>
<span id="cb20-104"><a href="#cb20-104"></a><span class="co">#&gt; 100 8.99 2.41365344 3.08638341 3.9956300</span></span>
<span id="cb20-105"><a href="#cb20-105"></a><span class="co">#&gt; 101 9.00 2.47883686 3.16815388 4.0978049</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Gelman, A., &amp; Rubin, D. B. (1992). <em>Inference from iterative simulation using multiple sequences</em>, Statistical Science, 7(4), 457–472.</p>
<p>Hrafnkelsson, B., Sigurdarson, H., and Gardarsson, S. M. (2022). <em>Generalization of the power-law rating curve using hydrodynamic theory and Bayesian hierarchical modeling</em>, Environmetrics, 33(2):e2711.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://english.hi.is/staff/birgirhr" class="external-link">Birgir Hrafnkelsson</a>, <a href="https://github.com/sor16" class="external-link">Solvi Rognvaldsson</a>, <a href="https://github.com/axelornj" class="external-link">Axel Orn Jansson</a>, <a href="https://github.com/RafaelVias" class="external-link">Rafael Vias</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
